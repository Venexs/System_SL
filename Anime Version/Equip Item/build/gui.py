
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage
import json
import csv
import subprocess
import cv2
from PIL import Image, ImageTk

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"assets\frame0")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)

class VideoPlayer:
    def __init__(self, canvas, video_path, x, y, frame_skip=2, resize_factor=0.8):
        self.canvas = canvas
        self.video_path = video_path
        self.cap = cv2.VideoCapture(video_path)
        self.x = x
        self.y = y
        self.frame_skip = frame_skip  # Number of frames to skip
        self.resize_factor = resize_factor  # Factor to resize frames
        self.image_id = self.canvas.create_image(self.x, self.y)
        self.frame_count = 0
        self.update_frame()

    def update_frame(self):
        ret, frame = self.cap.read()
        
        if not ret:
            # If the video has ended, reset the capture object
            self.cap.set(cv2.CAP_PROP_POS_FRAMES, 0)
            ret, frame = self.cap.read()

        if ret:
            self.frame_count += 1
            if self.frame_count % self.frame_skip == 0:  # Skip frames for performance
                frame = cv2.resize(frame, (0, 0), fx=self.resize_factor, fy=self.resize_factor)
                frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
                img = Image.fromarray(frame)
                imgtk = ImageTk.PhotoImage(image=img)
                self.canvas.itemconfig(self.image_id, image=imgtk)
                self.canvas.imgtk = imgtk

        self.canvas.after(10, self.update_frame)

    def __del__(self):
        self.cap.release()

def start_move(event):
    global lastx, lasty
    lastx = event.x_root
    lasty = event.y_root

def move_window(event):
    global lastx, lasty
    deltax = event.x_root - lastx
    deltay = event.y_root - lasty
    x = window.winfo_x() + deltax
    y = window.winfo_y() + deltay
    window.geometry("+%s+%s" % (x, y))
    lastx = event.x_root
    lasty = event.y_root

def ex_close(win):
    win.quit()

subprocess.Popen(['python', 'sfx.py'])

window = Tk()

window.geometry("555x373")
window.configure(bg = "#FFFFFF")
window.attributes('-alpha',0.8)
window.overrideredirect(True)
window.wm_attributes("-topmost", True)
#window.update()

canvas = Canvas(
    window,
    bg = "#FFFFFF",
    height = 373,
    width = 555,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)

# ! ======================================================================
# ! FILE RETRIEVAL
# ! ======================================================================

name1=name2=name3=name4=name5='-'
rank1=rank2=rank3=rank4=rank5='X'
dat1=dat2=dat3=dat4=dat5={}

with open('Files/Temp Files/Equipment Temp.csv', 'r') as fop:
    fr=csv.reader(fop)
    for k in fr:
        cat=k[0]
        try:
            typ=k[1]
        except:
            print()

with open('Files/Inventory.json', 'r') as fout:
    data=json.load(fout)
    rol=list(data.keys())

c=0
for k in rol:
    if data[k][0]["cat"]==cat:
        if c==0:
            name1=k
            rank1=data[k][0]["rank"]
            dat1[k]=data[k]
            c+=1
        elif c==1:
            name2=k
            rank2=data[k][0]["rank"]
            dat2[k]=data[k]
            c+=1
        elif c==2:
            name3=k
            rank3=data[k][0]["rank"]
            dat3[k]=data[k]
            c+=1
        elif c==3:
            name4=k
            rank4=data[k][0]["rank"]
            dat4[k]=data[k]
            c+=1
        elif c==4:
            name5=k
            rank5=data[k][0]["rank"]
            dat5[k]=data[k]
            c+=1

# ! ======================================================================
# ! FILE INJECTION
# ! ======================================================================

def opens(val, name):
    with open('Files/Equipment.json', 'r') as first_equipment_file:
        first_equipment_file_data=json.load(first_equipment_file)
        if first_equipment_file_data[cat]!={}:
            item_old_name=list(first_equipment_file_data[cat].keys())[0]
            old_item_buff_main=list(first_equipment_file_data[cat][item_old_name][0]["buff"].keys())
            try:
                # ? HELM BUFF 1 
                old_item_boost_1_name=old_item_buff_main[0]
                if old_item_boost_1_name=="AGIbuff":
                    oldbuff_1_name="AGI"
                elif old_item_boost_1_name=="STRbuff":
                    oldbuff_1_name="STR"
                elif old_item_boost_1_name=="VITbuff":
                    oldbuff_1_name="VIT"
                elif old_item_boost_1_name=="INTbuff":
                    oldbuff_1_name="INT"
                elif old_item_boost_1_name=="PERbuff":
                    oldbuff_1_name="PER"
                elif old_item_boost_1_name=="MANbuff":
                    oldbuff_1_name="MAN"

                oldbuff1_value=data[cat][item_old_name][0]["buff"][old_item_boost_1_name]

                # ? HELM BUFF 2
                old_item_boost_2_name=old_item_buff_main[1]
                if old_item_boost_2_name=="AGIbuff":
                    oldbuff_2_name="AGI"
                elif old_item_boost_2_name=="STRbuff":
                    oldbuff_2_name="STR"
                elif old_item_boost_2_name=="VITbuff":
                    oldbuff_2_name="VIT"
                elif old_item_boost_2_name=="INTbuff":
                    oldbuff_2_name="INT"
                elif old_item_boost_2_name=="PERbuff":
                    oldbuff_2_name="PER"
                elif old_item_boost_2_name=="MANbuff":
                    oldbuff_2_name="MAN"

                oldbuff2_value=data[cat][item_old_name][0]["buff"][old_item_boost_2_name]
            except:
                print("",end='')

            try:
                old_item_debuff_main=list(first_equipment_file_data[cat][item_old_name][0]["debuff"].keys())
                # ? HELM BUFF 1 
                old_item_deboost_1_name=old_item_debuff_main[0]
                if old_item_deboost_1_name=="AGIbuff":
                    olddebuff_1_name="AGI"
                elif old_item_deboost_1_name=="STRdebuff":
                    olddebuff_1_name="STR"
                elif old_item_deboost_1_name=="VITdebuff":
                    olddebuff_1_name="VIT"
                elif old_item_deboost_1_name=="INTdebuff":
                    olddebuff_1_name="INT"
                elif old_item_deboost_1_name=="PERdebuff":
                    olddebuff_1_name="PER"
                elif old_item_deboost_1_name=="MANdebuff":
                    olddebuff_1_name="MAN"

                olddebuff1_value=data[cat][item_old_name][0]["debuff"][old_item_deboost_1_name]

                # ? HELM BUFF 2
                old_item_deboost_2_name=old_item_debuff_main[1]
                if old_item_deboost_2_name=="AGIdebuff":
                    olddebuff_2_name="AGI"
                elif old_item_deboost_2_name=="STRdebuff":
                    olddebuff_2_name="STR"
                elif old_item_deboost_2_name=="VITdebuff":
                    olddebuff_2_name="VIT"
                elif old_item_deboost_2_name=="INTdebuff":
                    olddebuff_2_name="INT"
                elif old_item_deboost_2_name=="PERdebuff":
                    olddebuff_2_name="PER"
                elif old_item_deboost_2_name=="MANdebuff":
                    olddebuff_2_name="MAN"

                olddebuff2_value=data[cat][item_old_name][0]["debuff"][old_item_deboost_2_name]
            except:
                print("",end='')

            with open("Files/status.json", 'r') as status_file_eq:
                status_file_eq_data=json.load(status_file_eq)
                try:
                    status_file_eq_data["equipment"][0][oldbuff_1_name]=-oldbuff1_value
                    status_file_eq_data["equipment"][0][oldbuff_2_name]=-oldbuff2_value
                except:
                    print()

                try:
                    status_file_eq_data["equipment"][0][olddebuff_1_name]=+olddebuff1_value
                    status_file_eq_data["equipment"][0][olddebuff_2_name]=+olddebuff2_value
                except:
                    print()

            with open('Files/Equipment.json', 'w') as second_write_equipment_file:
                json.dump(first_equipment_file_data, second_write_equipment_file, indent=6)

            with open('Files/status.json', 'w') as second_write_status_file:
                json.dump(status_file_eq_data, second_write_status_file, indent=4)

    if name!='-':
        with open('Files/Equipment.json', 'r') as finale:
            final_data=json.load(finale)
            if val==1:
                final_data[cat]=dat1
            elif val==2:
                final_data[cat]=dat2
            elif val==3:
                final_data[cat]=dat3
            elif val==4:
                final_data[cat]=dat4
            elif val==5:
                final_data[cat]=dat5
        
        with open('Files/Equipment.json', 'w') as inject:
            json.dump(final_data, inject, indent=6)

        with open('Files/Equipment.json', 'r') as second_equipment_file:
            second_equipment_file_data=json.load(second_equipment_file)
            item_new_name=list(second_equipment_file_data[cat].keys())[0]
            new_item_buff_main=list(second_equipment_file_data[cat][item_new_name][0]["buff"].keys())

            # ? HELM BUFF 1 
            new_item_boost_1_name=new_item_buff_main[0]
            if new_item_boost_1_name=="AGIbuff":
                newbuff_1_name="AGI"
            elif new_item_boost_1_name=="STRbuff":
                newbuff_1_name="STR"
            elif new_item_boost_1_name=="VITbuff":
                newbuff_1_name="VIT"
            elif new_item_boost_1_name=="INTbuff":
                newbuff_1_name="INT"
            elif new_item_boost_1_name=="PERbuff":
                newbuff_1_name="PER"
            elif new_item_boost_1_name=="MANbuff":
                newbuff_1_name="MAN"

            newbuff1_value=second_equipment_file_data[cat][item_new_name][0]["buff"][new_item_boost_1_name]

            try:
                # ? HELM BUFF 2
                new_item_boost_2_name=new_item_buff_main[1]
                if new_item_boost_2_name=="AGIbuff":
                    newbuff_2_name="AGI"
                elif new_item_boost_2_name=="STRbuff":
                    newbuff_2_name="STR"
                elif new_item_boost_2_name=="VITbuff":
                    newbuff_2_name="VIT"
                elif new_item_boost_2_name=="INTbuff":
                    newbuff_2_name="INT"
                elif new_item_boost_2_name=="PERbuff":
                    newbuff_2_name="PER"
                elif new_item_boost_2_name=="MANbuff":
                    newbuff_2_name="MAN"

                newbuff2_value=second_equipment_file_data[cat][item_new_name][0]["buff"][new_item_boost_2_name]
            except:
                print("",end='')

            try:
                new_item_debuff_main=list(second_equipment_file_data[cat][item_new_name][0]["debuff"].keys())
                # ? HELM BUFF 1 
                new_item_deboost_1_name=new_item_debuff_main[0]
                if new_item_deboost_1_name=="AGIdebuff":
                    newbuff_1_name="AGI"
                elif new_item_deboost_1_name=="STRdebuff":
                    newbuff_1_name="STR"
                elif new_item_deboost_1_name=="VITdebuff":
                    newbuff_1_name="VIT"
                elif new_item_deboost_1_name=="INTdebuff":
                    newbuff_1_name="INT"
                elif new_item_deboost_1_name=="PERdebuff":
                    newbuff_1_name="PER"
                elif new_item_deboost_1_name=="MANdebuff":
                    newbuff_1_name="MAN"

                newdebuff1_value=data[cat][item_new_name][0]["debuff"][new_item_deboost_1_name]

                # ? HELM BUFF 2
                new_item_deboost_2_name=new_item_buff_main[1]
                if new_item_deboost_2_name=="AGIdebuff":
                    newdebuff_2_name="AGI"
                elif new_item_deboost_2_name=="STRdebuff":
                    newdebuff_2_name="STR"
                elif new_item_deboost_2_name=="VITdebuff":
                    newdebuff_2_name="VIT"
                elif new_item_deboost_2_name=="INTdebuff":
                    newdebuff_2_name="INT"
                elif new_item_deboost_2_name=="PERdebuff":
                    newdebuff_2_name="PER"
                elif new_item_deboost_2_name=="MANdebuff":
                    newdebuff_2_name="MAN"

                newdebuff2_value=data[cat][item_new_name][0]["debuff"][new_item_deboost_2_name]
            except:
                print("",end='')

            with open("Files/status.json", 'r') as status2_file_eq:
                status2_file_eq_data=json.load(status2_file_eq)
                try:
                    status2_file_eq_data["equipment"][0][newbuff_1_name]=status2_file_eq_data["equipment"][0][newbuff_1_name]+newbuff1_value
                    status2_file_eq_data["equipment"][0][newbuff_2_name]=status2_file_eq_data["equipment"][0][newbuff_2_name]+newbuff2_value
                except:
                    print()

                try:
                    status2_file_eq_data["equipment"][0][olddebuff_1_name]=-newdebuff1_value
                    status2_file_eq_data["equipment"][0][olddebuff_2_name]=-newdebuff2_value
                except:
                    print()

            with open('Files/Equipment.json', 'w') as second_final_write_equipment_file:
                json.dump(second_equipment_file_data, second_final_write_equipment_file, indent=6)

            with open('Files/status.json', 'w') as second_final_write_status_file:
                json.dump(status2_file_eq_data, second_final_write_status_file, indent=4)

        subprocess.Popen(['python', 'Anime Version/Equipment/build/gui.py'])

        window.quit()

image_image_1 = PhotoImage(
    file=relative_to_assets("image_1.png"))
image_1 = canvas.create_image(
    277.0,
    390.0,
    image=image_image_1
)

video_path = "Files/0001-0200.mp4"
player = VideoPlayer(canvas, video_path, 277.0, 350.0)

image_image_2 = PhotoImage(
    file=relative_to_assets("image_2.png"))
image_2 = canvas.create_image(
    287.0,
    418.0,
    image=image_image_2
)

image_image_3 = PhotoImage(
    file=relative_to_assets("image_3.png"))
image_3 = canvas.create_image(
    277.0,
    102.0,
    image=image_image_3
)

image_image_4 = PhotoImage(
    file=relative_to_assets("image_4.png"))
image_4 = canvas.create_image(
    280.0,
    175.0,
    image=image_image_4
)

canvas.create_text(
    68.0,
    164.0,
    anchor="nw",
    text=name1,
    fill="#FFFFFF",
    font=("Montserrat Regular", 18 * -1)
)

canvas.create_text(
    391.0,
    164.0,
    anchor="nw",
    text=f"{rank1}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 18 * -1)
)

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: opens(1, name1),
    relief="flat"
)
button_1.place(
    x=481.0,
    y=163.0,
    width=24.0,
    height=24.0
)

image_image_5 = PhotoImage(
    file=relative_to_assets("image_5.png"))
image_5 = canvas.create_image(
    280.0,
    303.0,
    image=image_image_5
)

canvas.create_text(
    68.0,
    292.0,
    anchor="nw",
    text=name5,
    fill="#FFFFFF",
    font=("Montserrat Regular", 18 * -1)
)

canvas.create_text(
    391.0,
    292.0,
    anchor="nw",
    text=f"{rank5}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 18 * -1)
)

button_image_2 = PhotoImage(
    file=relative_to_assets("button_2.png"))
button_2 = Button(
    image=button_image_2,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: opens(5, name5),
    relief="flat"
)
button_2.place(
    x=481.0,
    y=291.0,
    width=24.0,
    height=24.0
)

image_image_6 = PhotoImage(
    file=relative_to_assets("image_6.png"))
image_6 = canvas.create_image(
    280.0,
    271.0,
    image=image_image_6
)

canvas.create_text(
    68.0,
    260.0,
    anchor="nw",
    text=name4,
    fill="#FFFFFF",
    font=("Montserrat Regular", 18 * -1)
)

canvas.create_text(
    391.0,
    260.0,
    anchor="nw",
    text=f"{rank4}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 18 * -1)
)

button_image_3 = PhotoImage(
    file=relative_to_assets("button_3.png"))
button_3 = Button(
    image=button_image_3,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: opens(4, name4),
    relief="flat"
)
button_3.place(
    x=481.0,
    y=259.0,
    width=24.0,
    height=24.0
)

image_image_7 = PhotoImage(
    file=relative_to_assets("image_7.png"))
image_7 = canvas.create_image(
    280.0,
    239.0,
    image=image_image_7
)

canvas.create_text(
    68.0,
    228.0,
    anchor="nw",
    text=name3,
    fill="#FFFFFF",
    font=("Montserrat Regular", 18 * -1)
)

canvas.create_text(
    391.0,
    228.0,
    anchor="nw",
    text=f"{rank3}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 18 * -1)
)

button_image_4 = PhotoImage(
    file=relative_to_assets("button_4.png"))
button_4 = Button(
    image=button_image_4,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: opens(3, name3),
    relief="flat"
)
button_4.place(
    x=481.0,
    y=227.0,
    width=24.0,
    height=24.0
)

image_image_8 = PhotoImage(
    file=relative_to_assets("image_8.png"))
image_8 = canvas.create_image(
    280.0,
    207.0,
    image=image_image_8
)

canvas.create_text(
    68.0,
    196.0,
    anchor="nw",
    text=name2,
    fill="#FFFFFF",
    font=("Montserrat Regular", 18 * -1)
)

canvas.create_text(
    391.0,
    196.0,
    anchor="nw",
    text=f"{rank2}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 18 * -1)
)

button_image_5 = PhotoImage(
    file=relative_to_assets("button_5.png"))
button_5 = Button(
    image=button_image_5,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: opens(2, name2),
    relief="flat"
)
button_5.place(
    x=481.0,
    y=195.0,
    width=24.0,
    height=24.0
)

image_0=canvas.create_rectangle(
    0.0,
    0.0,
    570.0,
    35.0,
    fill="#212121",
    outline="")

canvas.tag_bind(image_0, "<ButtonPress-1>", start_move)
canvas.tag_bind(image_0, "<B1-Motion>", move_window)

button_image_8 = PhotoImage(
    file=relative_to_assets("button_8.png"))
button_8 = Button(
    image=button_image_8,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: ex_close(window),
    relief="flat"
)
button_8.place(
    x=520.0,
    y=3.0,
    width=28.0,
    height=28.0
)

window.resizable(False, False)
window.mainloop()
